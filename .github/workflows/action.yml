name: Deploy Infrastructe 

on: 
  push: 
    branches: 
      - main

jobs: 
  deploy_site: 
    name: Install Ubuntu 
    runs-on: ubuntu-latest 
    defaults: 
      run: 
        working-directory: terraform 

    steps:
    - name: Checkout Repo 
      uses: actions/checkout@v4 

    - name: Setup Terraform 
      uses: hashicorp/setup-terraform@v2 

    - name: Terraform init 
      run: terraform init 
      env: 
        AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
        AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
    
    - name: Terraform Validate
      run: terraform validate
        
    - name: Terraform Plan 
      run: terraform plan
        
    - name: Terraform apply 
      run: terraform apply --auto-approve 
      env: 
        AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
        AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}      